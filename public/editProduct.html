<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>ä¿®æ”¹å•†å“</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background: #fafafa;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      border: 2px solid #000;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }

    input[type="text"], textarea {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #aaa;
      border-radius: 5px;
      font-size: 16px;
    }

    textarea {
      height: 120px;
      resize: vertical;
    }

    img {
      width: 100%;
      max-height: 250px;
      object-fit: cover;
      border: 1px solid #ccc;
      margin-top: 10px;
    }

    button {
      width: 100%;
      padding: 12px;
      background: #1976d2;
      color: white;
      border: none;
      font-size: 18px;
      margin-top: 20px;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background: #0d47a1;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>ä¿®æ”¹å•†å“</h2>

  <label>å•†å“åç¨±</label>
  <input type="text" id="productName">

  <label>å•†å“èªªæ˜</label>
  <textarea id="productDesc"></textarea>

  <label>å•†å“åœ–ç‰‡ï¼ˆé‡æ–°ä¸Šå‚³ï¼‰</label>
  <input type="file" id="productImage" accept="image/*">

  <img id="previewImage" src="" alt="ç›®å‰å•†å“åœ–ç‰‡">

  <button onclick="updateProduct()">æ›´æ–°å•†å“</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js"></script>

<script>
  // TODOï¼šæ›æˆä½ çš„ Firebase è¨­å®š
  const firebaseConfig = {
    apiKey: "AIzaSyAXNkqm1UYZzTm6LZ_tctZ9L4YSDEWf1bc",
    authDomain: "sgtp-b3066.firebaseapp.com",
    databaseURL: "https://sgtp-b3066-default-rtdb.firebaseio.com",
    projectId: "sgtp-b3066",
    storageBucket: "sgtp-b3066.firebasestorage.app",
    messagingSenderId: "806654636750",
    appId: "1:806654636750:web:48af99545d41f536dd569f"
    };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  // å–å¾—å•†å“ ID
  const urlParams = new URLSearchParams(window.location.search);
  const productId = urlParams.get("id");

  const nameInput = document.getElementById("productName");
  const descInput = document.getElementById("productDesc");
  const imgPreview = document.getElementById("previewImage");
  const imgInput   = document.getElementById("productImage");

  let currentImageUrl = ""; // Firestore åŸæœ¬çš„åœ–ç‰‡ URL

  // ğŸ”¥ è¼‰å…¥å•†å“è³‡æ–™
  async function loadProduct() {
    const doc = await db.collection("products").doc(productId).get();

    if (!doc.exists) {
      alert("æ‰¾ä¸åˆ°æ­¤å•†å“ï¼");
      return;
    }

    const data = doc.data();

    nameInput.value = data.name || "";
    descInput.value = data.description || "";
    currentImageUrl = data.imageUrl || "";

    imgPreview.src = currentImageUrl || "https://via.placeholder.com/300x200?text=No+Image";
  }

  loadProduct();

  // ğŸ”¥ æ›´æ–°å•†å“è³‡æ–™
  async function updateProduct() {
    const name = nameInput.value.trim();
    const desc = descInput.value.trim();
    const imageFile = imgInput.files[0];

    if (!name) {
      alert("å•†å“åç¨±ä¸èƒ½ç‚ºç©ºï¼");
      return;
    }

    let newImageUrl = currentImageUrl;

    // ğŸ”¥ å¦‚æœä½¿ç”¨è€…æœ‰é‡æ–°ä¸Šå‚³åœ–ç‰‡ â†’ ä¸Šå‚³ Firebase Storage
    if (imageFile) {
      const storageRef = storage.ref(`products/${productId}_${Date.now()}`);
      await storageRef.put(imageFile);
      newImageUrl = await storageRef.getDownloadURL();
    }

    // ğŸ”¥ æ›´æ–° Firestore
    await db.collection("products").doc(productId).update({
      name,
      description: desc,
      imageUrl: newImageUrl,
      updatedAt: new Date()
    });

    alert("å•†å“æ›´æ–°æˆåŠŸï¼");
    window.location.href = "sellerDashboard.html";
  }
</script>

</body>
</html>
